import"./main-B3CKXS3W.js";import{U as B}from"./api-CdacEXtS.js";import{C as Z,i as q}from"./component-popup-DlzYQJtm.js";import{i as C}from"./initAlert-BKKo3IwO.js";customElements.define("widget-popup",Z);const T=document.querySelector("#sign-in-btn"),J=document.querySelector("#sign-up-btn"),F=document.querySelector(".container");J.addEventListener("click",()=>{F.classList.add("sign-up-mode")});T.addEventListener("click",()=>{F.classList.remove("sign-up-mode")});function R(){return{firstName:document.getElementById("first-name").value.trim(),lastName:document.getElementById("last-name").value.trim(),middleName:document.getElementById("middle-name").value.trim(),birthDate:document.getElementById("birth-date").value,phone:document.getElementById("phone").value.trim(),email:document.getElementById("email").value.trim(),nickname:document.getElementById("nickname").value.trim(),password:Y(),role:"user"}}function Y(){return document.getElementById("password-option").value==="manual"?document.getElementById("password").value:document.getElementById("auto-password").value}async function G(d){try{const o=await fetch(B,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!o.ok){const p=await o.json();throw new Error(p.message||"Ошибка регистрации")}return await o.json()}catch(o){throw console.error("Registration failed:",o),alert(`Ошибка регистрации: ${o.message}`),o}}document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("login-form"),o=document.getElementById("login-username"),p=document.getElementById("login-password");d.addEventListener("submit",async e=>{e.preventDefault();const t=o.value.trim(),n=p.value;try{const a=(await(await fetch(B)).json()).find(i=>i.nickname===t&&i.password===n);a?(localStorage.setItem("user",JSON.stringify({id:a.id,email:a.email,nickname:a.nickname,role:a.role})),a.cart?localStorage.setItem("cart",JSON.stringify(a.cart)):localStorage.removeItem("cart"),a.favorites?localStorage.setItem("favorite",JSON.stringify(a.favorites)):localStorage.removeItem("favorite"),window.location.href="/"):C("Неверный логин или пароль")}catch(r){alert(`Ошибка входа: ${r.message}`)}});const y=document.getElementById("registration-form"),c=document.getElementById("nickname"),f=document.getElementById("regen-nickname"),b=document.getElementById("submit-button"),v=document.getElementById("password-option"),k=document.getElementById("manual-password-fields"),S=document.getElementById("auto-password-fields"),N=document.getElementById("auto-password"),z=document.getElementById("generate-password"),M=document.getElementById("agreement");let h=0;function s(e,t){let n=e.parentElement.querySelector(".error-msg");n||(n=document.createElement("div"),n.className="error-msg",n.style.position="absolute",n.style.top="100%",n.style.color="red",n.style.fontSize="12px",n.style.marginTop="0",e.parentElement.style.position="relative",e.parentElement.appendChild(n)),n.textContent=t}function A(e){const t=e.parentElement.querySelector(".error-msg");t&&t.remove()}function U(){const e=document.getElementById("first-name").value.trim().slice(0,3),t=document.getElementById("last-name").value.trim().slice(0,3),n=Math.floor(Math.random()*990+10),r=["","_by","_dev","_x","_007"][Math.floor(Math.random()*5)];return(e+t+n+r).replace(/[^a-zA-Zа-яА-Я0-9_]/g,"")}async function j(e){return(await(await fetch(`${B}?nickname=${encodeURIComponent(e)}`)).json()).length>0}f.addEventListener("click",()=>{h<5?(c.value=U(),h++):(c.removeAttribute("readonly"),f.disabled=!0)}),v.addEventListener("change",()=>{v.value==="manual"?(k.style.display="block",S.style.display="none"):(k.style.display="none",S.style.display="block")}),z.addEventListener("click",()=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let t="";for(;!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*]).{8,20}/.test(t);)t=Array.from({length:12},()=>e[Math.floor(Math.random()*e.length)]).join("");N.value=t}),y.addEventListener("input",async()=>{const e=document.getElementById("phone"),t=document.getElementById("birth-date"),n=document.getElementById("email"),r=document.getElementById("password"),u=document.getElementById("password-confirm"),a=document.getElementById("terms"),i=document.getElementById("first-name"),E=document.getElementById("last-name"),m=document.getElementById("middle-name"),g=document.getElementById("nickname");[e,t,n,r,u,i,E,m].forEach(A);const L=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(i.value.trim());L||s(i,"Введите корректное имя (только буквы, пробелы и дефисы)");const D=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(E.value.trim());D||s(E,"Введите корректную фамилию (только буквы, пробелы)");const V=m.value.trim()===""||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(m.value.trim());m.value.trim()&&!V&&s(m,"Введите корректное отчество (только буквы, пробелы)");const $=/^\+375(25|29|33|44|17)\d{7}$/.test(e.value.trim());$||s(e,"Введите корректный номер РБ: +375XXXXXXXXX");const O=/\S+@\S+\.\S+/.test(n.value.trim());O||s(n,"Некорректный email");const X=g.value.trim();let w=X.length>0;w?await j(X)?(w=!1,s(g,"Этот никнейм уже занят")):A(g):s(g,"Введите никнейм");const _=new Date(t.value),I=new Date,x=I.getFullYear()-_.getFullYear()-(I<new Date(_.setFullYear(I.getFullYear()))?1:0)>=16;x||s(t,"Регистрация с 16 лет");let l=!0;v.value==="manual"?(l=/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*]).{8,20}/.test(r.value),l||s(r,"Пароль: 8-20 символов, с заглавной, цифрой и спецсимволом"),r.value!==u.value&&(l=!1,s(u,"Пароли не совпадают"))):l=N.value.length>=8;const P=a.checked;b.disabled=!($&&O&&x&&l&&P&&L&&D&&V&&w)}),M.addEventListener("click",e=>{q("Agreement","By accessing and using this website, you agree to comply with the terms and conditions set forth in this User Agreement. The information, services, and products provided on this site are intended for personal, non-commercial use. Users must not engage in any activities that may disrupt or damage the website or compromise its security. All content, including text, images, and trademarks, is the property of the site owner and may not be used without permission. The company reserves the right to modify this agreement at any time, and continued use of the site constitutes acceptance of those changes.")}),y.addEventListener("submit",async e=>{e.preventDefault();const t=R();await G(t),C("Регистрация прошла успешно!"),y.reset(),b.disabled=!0,c.value="",c.setAttribute("readonly",!0),f.disabled=!1,h=0})});
